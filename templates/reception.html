
{% extends "layout.html" %}
{% block title %}Tableau de Bord - R√©ception{% endblock %}

{% block content %}
    <div class="header-bar">
        <h1>Tableau de Bord</h1>
        <div class="header-actions">
            <a href="{{ url_for('show_checkin_form') }}" class="btn btn-primary">Nouveau Check-in</a>
            <a href="{{ url_for('reservations_page') }}" class="btn btn-secondary">Cr√©er R√©servation</a>
        </div>
    </div>

    <!-- Grille des statistiques -->
    <div class="dashboard-grid">
        <!-- Carte Revenu -->
        <div class="stat-card">
            <div class="card-icon revenue">üí∞</div>
            <div class="card-content">
                <h3>Revenu du Jour</h3>
                <p>{{ "%.0f" | format(stats.daily_revenue) }} FCFA</p>
            </div>
        </div>

        <!-- Carte Arriv√©es -->
        <div class="stat-card">
            <div class="card-icon arrivals">üè®</div>
            <div class="card-content">
                <h3>Arriv√©es Pr√©vues</h3>
                <p>{{ stats.todays_arrivals }}</p>
            </div>
        </div>

        <!-- Carte D√©parts -->
        <div class="stat-card">
            <div class="card-icon departures">üëã</div>
            <div class="card-content">
                <h3>D√©parts Pr√©vus</h3>
                <p>{{ stats.todays_departures }}</p>
            </div>
        </div>

        <!-- Carte Taux d'Occupation -->
        <div class="stat-card wide-card">
             <div class="card-icon rooms">üìä</div>
             <div class="card-content">
                <h3>√âtat des Chambres</h3>
                <canvas id="roomStatusChart" width="400" height="170"></canvas>
            </div>
        </div>
    </div>

    <!-- Section des listes (inchang√©e) -->
    <div class="dashboard-lists">
        <div class="widget-card">
            <h4>S√©jours Actifs</h4>
            <table class="dashboard-table">
                <thead>
                    <tr>
                        <th>Chambre</th>
                        <th>Client</th>
                        <th>Date Check-in</th>
                        <th>Solde</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stay in active_stays %}
                    <tr>
                        <td>{{ stay.numero }}</td>
                        <td>{{ stay.client_nom }}</td>
                        <td>{{ stay.date_checkin.split(' ')[0] }}</td>
                        <td>{{ stay.solde_actuel }} FCFA</td>
                        <td><a href="{{ url_for('show_billing', stay_id=stay.id) }}" class="btn-action">Facturer / Checkout</a></td>
                    </tr>
                    {% else %}
                    <tr><td colspan="5">Aucun s√©jour actif pour le moment.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="widget-card">
            <h4>Arriv√©es Pr√©vues Aujourd'hui</h4>
            <ul class="simple-list">
                {% for arrival in todays_arrivals %}
                    <li><strong>{{ arrival.client_nom }}</strong> (Ch. {{ arrival.numero }})</li>
                {% else %}
                    <li>Aucune arriv√©e pr√©vue pour aujourd'hui.</li>
                {% endfor %}
            </ul>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('roomStatusChart').getContext('2d');

    // R√©cup√©rer les donn√©es depuis le template
    const roomCounts = {{ stats.room_counts | tojson }};
    const labels = Object.keys(roomCounts);
    const data = Object.values(roomCounts);

    const roomStatusChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                label: '√âtat des Chambres',
                data: data,
                backgroundColor: [
                    '#4CAF50', // Libre
                    '#F44336', // Occup√©e
                    '#FFC107', // R√©serv√©e
                    '#9E9E9E'  // Autre
                ],
                borderColor: '#fff',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                }
            }
        }
    });
});
</script>
{% endblock %}
